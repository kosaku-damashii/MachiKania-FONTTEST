USEGRAPHIC 9
USECLASS CKNJ16
USEVAR MAXH,MAXW,CHRH,CHRW,CODE,SLCT,CSR_X,CSR_Y
MAXW=SYSTEM(22)
MAXH=SYSTEM(23)
CHRW=16
CHRH=16
CSR_X=0
CSR_Y=SYSTEM(21)-1
SLCT=$B1A1
CODE=SLCT
X=0
Y=MAXH-1-CHRH

FOR I=0 TO (MAXW/CHRW)-2
  K=NEW(CKNJ16,"EUC-JP")
  POINT X+CHRW*I,Y
  C$=CHR$(((CODE+I)>>8) AND $FF)+CHR$((CODE+I) AND $FF)+CHR$($00)
  K.GPRT(C$,7,0)
NEXT

CURSOR CSR_X,CSR_Y
PRINT CHR$($5F)+CHR$($5F)

WHILE 1
  S=READKEY()
  IF S THEN
    A=(S >> 8) AND $FF
    CURSOR CSR_X,CSR_Y
    PRINT "  "
    IF A=$26 THEN
      CSR_Y=CSR_Y-2
    ELSEIF A=$28 THEN
      CSR_Y=CSR_Y+2
    ELSEIF A=$25 THEN
      CSR_X=CSR_X-2
    ELSEIF A=$27 THEN
      CSR_X=CSR_X+2
    ENDIF

    IF CSR_X < 0 THEN
      IF CODE < $A1A1 THEN
        CODE=$A1A1
        CSR_X=0
     ELSE
       BOXFILL 0,MAXH-1-CHRH,MAXW-1,MAXH-1,0
       CODE=CODE-$100
       FOR I=0 TO (MAXW/CHRW)-2
         POINT X+CHRW*I,Y
         C$=CHR$(((CODE+I)>>8) AND $FF)+CHR$((CODE+I) AND $FF)+CHR$($00)
         K.GPRT(C$,7,0)
       NEXT
       CSR_X=SYSTEM(20)-4
     ENDIF
    ELSEIF CSR_X >= SYSTEM(20)-2 THEN

      IF CODE > $FEA1 THEN
        CODE=$FEA1
        CSR_X=SYSTEM(20)-4
     ELSE
       BOXFILL 0,MAXH-1-CHRH,MAXW-1,MAXH-1,0
       CODE=CODE+$100
       FOR I=0 TO (MAXW/CHRW)-2
         POINT X+CHRW*I,Y
         C$=CHR$(((CODE+I)>>8) AND $FF)+CHR$((CODE+I) AND $FF)+CHR$($00)
         K.GPRT(C$,7,0)
       NEXT
       CSR_X=0
     ENDIF
    ELSEIF CSR_Y < 0 THEN
      CSR_Y=0
    ELSEIF CSR_Y >= SYSTEM(21) THEN
      CSR_Y=SYSTEM(21)-1
    ENDIF


    CURSOR CSR_X,CSR_Y
    PRINT CHR$($5F)+CHR$($5F)
  ENDIF
WEND
